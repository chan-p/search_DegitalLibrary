{"version":3,"sources":["../../src/pdf.js-contrib/text_layer_builder.js"],"names":[],"mappings":"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","file":"text_layer_builder.js","sourcesContent":["/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals PDFJS */\n\n'use strict';\n\n/**\n * @typedef {Object} TextLayerBuilderOptions\n * @property {HTMLDivElement} textLayerDiv - The text layer container.\n * @property {number} pageIndex - The page index.\n * @property {PageViewport} viewport - The viewport of the text layer.\n * @property {PDFFindController} findController\n */\n\n/**\n * TextLayerBuilder provides text-selection functionality for the PDF.\n * It does this by creating overlay divs over the PDF text. These divs\n * contain text that matches the PDF text they are overlaying. This object\n * also provides a way to highlight text that is being searched for.\n * @class\n */\nvar TextLayerBuilder = (function TextLayerBuilderClosure() {\n  function TextLayerBuilder(options) {\n    this.textLayerDiv = options.textLayerDiv;\n    this.renderingDone = false;\n    this.divContentDone = false;\n    this.pageIdx = options.pageIndex;\n    this.pageNumber = this.pageIdx + 1;\n    this.matches = [];\n    this.viewport = options.viewport;\n    this.textDivs = [];\n    this.findController = options.findController || null;\n    this.textLayerRenderTask = null;\n    this._bindMouse();\n  }\n\n  TextLayerBuilder.prototype = {\n    _finishRendering: function TextLayerBuilder_finishRendering() {\n      this.renderingDone = true;\n\n      var endOfContent = document.createElement('div');\n      endOfContent.className = 'endOfContent';\n      this.textLayerDiv.appendChild(endOfContent);\n\n      var event = document.createEvent('CustomEvent');\n      event.initCustomEvent('textlayerrendered', true, true, {\n        pageNumber: this.pageNumber\n      });\n      this.textLayerDiv.dispatchEvent(event);\n    },\n\n    /**\n     * Renders the text layer.\n     * @param {number} timeout (optional) if specified, the rendering waits\n     *   for specified amount of ms.\n     */\n    render: function TextLayerBuilder_render(timeout) {\n      if (!this.divContentDone || this.renderingDone) {\n        return;\n      }\n\n      if (this.textLayerRenderTask) {\n        this.textLayerRenderTask.cancel();\n        this.textLayerRenderTask = null;\n      }\n\n      this.textDivs = [];\n      var textLayerFrag = document.createDocumentFragment();\n      this.textLayerRenderTask = PDFJS.renderTextLayer({\n        textContent: this.textContent,\n        container: textLayerFrag,\n        viewport: this.viewport,\n        textDivs: this.textDivs,\n        timeout: timeout\n      });\n      this.textLayerRenderTask.promise.then(function () {\n        this.textLayerDiv.appendChild(textLayerFrag);\n        this._finishRendering();\n        this.updateMatches();\n      }.bind(this), function (reason) {\n        // canceled or failed to render text layer -- skipping errors\n      });\n    },\n\n    setTextContent: function TextLayerBuilder_setTextContent(textContent) {\n      if (this.textLayerRenderTask) {\n        this.textLayerRenderTask.cancel();\n        this.textLayerRenderTask = null;\n      }\n      this.textContent = textContent;\n      this.divContentDone = true;\n    },\n\n    convertMatches: function TextLayerBuilder_convertMatches(matches) {\n      var i = 0;\n      var iIndex = 0;\n      var bidiTexts = this.textContent.items;\n      var end = bidiTexts.length - 1;\n      var queryLen = (this.findController === null ?\n                      0 : this.findController.state.query.length);\n      var ret = [];\n\n      for (var m = 0, len = matches.length; m < len; m++) {\n        // Calculate the start position.\n        var matchIdx = matches[m];\n\n        // Loop over the divIdxs.\n        while (i !== end && matchIdx >= (iIndex + bidiTexts[i].str.length)) {\n          iIndex += bidiTexts[i].str.length;\n          i++;\n        }\n\n        if (i === bidiTexts.length) {\n          console.error('Could not find a matching mapping');\n        }\n\n        var match = {\n          begin: {\n            divIdx: i,\n            offset: matchIdx - iIndex\n          }\n        };\n\n        // Calculate the end position.\n        matchIdx += queryLen;\n\n        // Somewhat the same array as above, but use > instead of >= to get\n        // the end position right.\n        while (i !== end && matchIdx > (iIndex + bidiTexts[i].str.length)) {\n          iIndex += bidiTexts[i].str.length;\n          i++;\n        }\n\n        match.end = {\n          divIdx: i,\n          offset: matchIdx - iIndex\n        };\n        ret.push(match);\n      }\n\n      return ret;\n    },\n\n    renderMatches: function TextLayerBuilder_renderMatches(matches) {\n      // Early exit if there is nothing to render.\n      if (matches.length === 0) {\n        return;\n      }\n\n      var bidiTexts = this.textContent.items;\n      var textDivs = this.textDivs;\n      var prevEnd = null;\n      var pageIdx = this.pageIdx;\n      var isSelectedPage = (this.findController === null ?\n        false : (pageIdx === this.findController.selected.pageIdx));\n      var selectedMatchIdx = (this.findController === null ?\n                              -1 : this.findController.selected.matchIdx);\n      var highlightAll = (this.findController === null ?\n                          false : this.findController.state.highlightAll);\n      var infinity = {\n        divIdx: -1,\n        offset: undefined\n      };\n\n      function beginText(begin, className) {\n        var divIdx = begin.divIdx;\n        textDivs[divIdx].textContent = '';\n        appendTextToDiv(divIdx, 0, begin.offset, className);\n      }\n\n      function appendTextToDiv(divIdx, fromOffset, toOffset, className) {\n        var div = textDivs[divIdx];\n        var content = bidiTexts[divIdx].str.substring(fromOffset, toOffset);\n        var node = document.createTextNode(content);\n        if (className) {\n          var span = document.createElement('span');\n          span.className = className;\n          span.appendChild(node);\n          div.appendChild(span);\n          return;\n        }\n        div.appendChild(node);\n      }\n\n      var i0 = selectedMatchIdx, i1 = i0 + 1;\n      if (highlightAll) {\n        i0 = 0;\n        i1 = matches.length;\n      } else if (!isSelectedPage) {\n        // Not highlighting all and this isn't the selected page, so do nothing.\n        return;\n      }\n\n      for (var i = i0; i < i1; i++) {\n        var match = matches[i];\n        var begin = match.begin;\n        var end = match.end;\n        var isSelected = (isSelectedPage && i === selectedMatchIdx);\n        var highlightSuffix = (isSelected ? ' selected' : '');\n\n        if (this.findController) {\n          this.findController.updateMatchPosition(pageIdx, i, textDivs,\n                                                  begin.divIdx, end.divIdx);\n        }\n\n        // Match inside new div.\n        if (!prevEnd || begin.divIdx !== prevEnd.divIdx) {\n          // If there was a previous div, then add the text at the end.\n          if (prevEnd !== null) {\n            appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n          }\n          // Clear the divs and set the content until the starting point.\n          beginText(begin);\n        } else {\n          appendTextToDiv(prevEnd.divIdx, prevEnd.offset, begin.offset);\n        }\n\n        if (begin.divIdx === end.divIdx) {\n          appendTextToDiv(begin.divIdx, begin.offset, end.offset,\n                          'highlight' + highlightSuffix);\n        } else {\n          appendTextToDiv(begin.divIdx, begin.offset, infinity.offset,\n                          'highlight begin' + highlightSuffix);\n          for (var n0 = begin.divIdx + 1, n1 = end.divIdx; n0 < n1; n0++) {\n            textDivs[n0].className = 'highlight middle' + highlightSuffix;\n          }\n          beginText(end, 'highlight end' + highlightSuffix);\n        }\n        prevEnd = end;\n      }\n\n      if (prevEnd) {\n        appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n      }\n    },\n\n    updateMatches: function TextLayerBuilder_updateMatches() {\n      // Only show matches when all rendering is done.\n      if (!this.renderingDone) {\n        return;\n      }\n\n      // Clear all matches.\n      var matches = this.matches;\n      var textDivs = this.textDivs;\n      var bidiTexts = this.textContent.items;\n      var clearedUntilDivIdx = -1;\n\n      // Clear all current matches.\n      for (var i = 0, len = matches.length; i < len; i++) {\n        var match = matches[i];\n        var begin = Math.max(clearedUntilDivIdx, match.begin.divIdx);\n        for (var n = begin, end = match.end.divIdx; n <= end; n++) {\n          var div = textDivs[n];\n          div.textContent = bidiTexts[n].str;\n          div.className = '';\n        }\n        clearedUntilDivIdx = match.end.divIdx + 1;\n      }\n\n      if (this.findController === null || !this.findController.active) {\n        return;\n      }\n\n      // Convert the matches on the page controller into the match format\n      // used for the textLayer.\n      this.matches = this.convertMatches(this.findController === null ?\n        [] : (this.findController.pageMatches[this.pageIdx] || []));\n      this.renderMatches(this.matches);\n    },\n\n    /**\n     * Fixes text selection: adds additional div where mouse was clicked.\n     * This reduces flickering of the content if mouse slowly dragged down/up.\n     * @private\n     */\n    _bindMouse: function TextLayerBuilder_bindMouse() {\n      var div = this.textLayerDiv;\n      div.addEventListener('mousedown', function (e) {\n        var end = div.querySelector('.endOfContent');\n        if (!end) {\n          return;\n        }\n//#if !(MOZCENTRAL || FIREFOX)\n        // On non-Firefox browsers, the selection will feel better if the height\n        // of the endOfContent div will be adjusted to start at mouse click\n        // location -- this will avoid flickering when selections moves up.\n        // However it does not work when selection started on empty space.\n        var adjustTop = e.target !== div;\n//#if GENERIC\n        adjustTop = adjustTop && window.getComputedStyle(end).\n          getPropertyValue('-moz-user-select') !== 'none';\n//#endif\n        if (adjustTop) {\n          var divBounds = div.getBoundingClientRect();\n          var r = Math.max(0, (e.pageY - divBounds.top) / divBounds.height);\n          end.style.top = (r * 100).toFixed(2) + '%';\n        }\n//#endif\n        end.classList.add('active');\n      });\n      div.addEventListener('mouseup', function (e) {\n        var end = div.querySelector('.endOfContent');\n        if (!end) {\n          return;\n        }\n//#if !(MOZCENTRAL || FIREFOX)\n        end.style.top = '';\n//#endif\n        end.classList.remove('active');\n      });\n    },\n  };\n  return TextLayerBuilder;\n})();\n\n/**\n * @constructor\n * @implements IPDFTextLayerFactory\n */\nfunction DefaultTextLayerFactory() {}\nDefaultTextLayerFactory.prototype = {\n  /**\n   * @param {HTMLDivElement} textLayerDiv\n   * @param {number} pageIndex\n   * @param {PageViewport} viewport\n   * @returns {TextLayerBuilder}\n   */\n  createTextLayerBuilder: function (textLayerDiv, pageIndex, viewport) {\n    return new TextLayerBuilder({\n      textLayerDiv: textLayerDiv,\n      pageIndex: pageIndex,\n      viewport: viewport\n    });\n  }\n};\n\nmodule.exports = {\n  TextLayerBuilder: TextLayerBuilder\n};"]}