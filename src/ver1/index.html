<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>WSL Degital Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ここにサイト説明を入れます">
<meta name="keywords" content="キーワード１,キーワード２,キーワード３,キーワード４,キーワード５">
<link rel="stylesheet" href="css/style.css">
</head>

<body>

<header>
<br>
<br>
<h1 id="logo"><a href="index.html"><img src="./images/logo1.png" alt="WSL Degital Library"></a></h1>
<nav id="menubar">
<ul>
<li><a href="#about">About</a></li>
<li><a href="#gallery">Search</a></li>
<li><a href="#all_list">ALL List</a></li>
<li><a href="http://wiki.wsl.mind.meiji.ac.jp/" target="_blank">WSL_Wiki</a></li>
</ul>
</nav>
</header>

<div class="contents" id="about">

<section id="new">
<h2>更新情報</h2>
<dl>
  <dt>2017/11/10</dt>
  <dd>WSL Degital Library 公開</dd>
  <dt>2017/11/10</dt>
  <dd>カテゴリ機能を実装</dd>
  <dt>2017/11/10</dt>
  <dd>ALL Listを実装</dd>
  <dt>2017/11/09</dt>
  <dd>WSL Degita Libraryを構築</dd>
</dl>
</section>

<p class="pagetop"><a href="#">↑</a></p>

</div>
<!--/contents-->

<div class="contents" id="gallery">

<section>

<h2>Search</h2>
<p>PDF化した書籍の検索ができます。</p>
<form name="js" id="id_js">
<h3>検索キーワード：<input type="text" name="txtb_kw" id="s1" value="" onkeypress="enterEvent(event.keyCode);"><input type="button" value="検索" onclick="dispButton();"><input type="button" value="クリア" onclick="clearText();"></3>
<div id="output2"></div>
<script type="text/javascript">
function enterEvent(code){
	//エンターキー押下なら
	if(13 === code){
		dispButton();
	}
}

function cateSearch(a){
  var file2 = "./PDF_list_column.txt";
  var rawFile2 = new XMLHttpRequest();
  var dic = {};
  rawFile2.open("GET", file2, false);
  rawFile2.onreadystatechange = function (){
      if(rawFile2.readyState == 4){
          if(rawFile2.status === 200 || rawFile2.status == 0){
              var allText2 = rawFile2.responseText;
              file_names2 = allText2.split("\n");
              for(var i = 0; i < file_names2.length; i++){
                  columns = file_names2[i].split(",");
                  dic[columns[0]] = new Array();
                  for(var ii = 1; ii < columns.length; ii++){
                      dic[columns[0]].push(columns[ii]);
                  }
              }
          }
      }
  }
  rawFile2.send(null);
  var tmp = String(a)
  var file5 = "./cate_search.txt";
  var rawFile5 = new XMLHttpRequest();
  var category = document.getElementById('cate'+tmp).value;
  var target = document.getElementById('output4');
  var url = "<br>";
  rawFile5.open("GET", file5, false);
  rawFile5.onreadystatechange = function (){
      if(rawFile5.readyState == 4){
          if(rawFile5.status === 200 || rawFile5.status == 0){
              var allText5 = rawFile5.responseText;
              file_names5 = allText5.split("\n");
              for(var i = 0; i < file_names5.length; i++){
		  var title_list = file_names5[i].split(",");
	          if(category == title_list[0]){
  		      var file0 = "./PDF_list_column.txt";
                      var rawFile0 = new XMLHttpRequest();
                      rawFile0.open("GET",file0,false);
		      rawFile0.onreadystatechange = function(){
      			  if(rawFile0.readyState == 4){
          		      if(rawFile0.status === 200 || rawFile0.status == 0){
              		          var allText0 = rawFile0.responseText;
                            	  file_names0 = allText0.split("\n");
              			  for(var ei = 0; ei < file_names0.length; ei++){
                		      if(title_list.indexOf(file_names0[ei].split(',')[0]) != -1){
				          title0 = file_names[ei].split(',')[0]
                  		          url += "<h3><div style='text-align:right;'><div style='text-align:left;float:left;'><input type='hidden' id='s31"+ei+"' value='" +title0+"'>" + title0+ "</input></div>カテゴリ：<input type='text' name='word' id='sss3"+ei+"' value=''></input><input type='button' value='追加' onclick='addCategory("+ei+");'></input><input type='button' value='削除' onclick='deleteCategory("+ei+");'></input><input type='button'  value='更新' onclick='koshin();'><a href='dlPDF/" +title0+ ".pdf#page=1 target='_blank''><img src='images/pdf-hiraku.png' alt='イラスト２' width=100 height=100></a><a href='dlPDF/" + title0+ ".pdf.zip#page=1 target='_blank''><img src='images/pdf-DL.png' alt='イラスト3' width=100 height=100></a></div></h3><h4>カテゴリ<br>";
                                          if(title0 in dic){
                    			      for(n=0; n < dic[title0].length; n++){
                      			          url += "<input type='button' style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + dic[title0][n] + "' onclick='pushingButton("+n+", "+ei+", "+file_names0.length+");'>";
                                              }
                  	 	          }			  
                  			  url += "</h4><br>";
                		      }
              			  }
		  	      }
	      		  }
          	      }
		      rawFile0.send(null);
      		  }
  	      }
	}
      }
  }  
  rawFile5.send(null);
  target.innerHTML = url;
}

function dispButton(){
  var file2 = "./PDF_list_column.txt";
  var rawFile2 = new XMLHttpRequest();
  var dic = {};
  rawFile2.open("GET", file2, false);
  rawFile2.onreadystatechange = function (){
      if(rawFile2.readyState == 4){
          if(rawFile2.status === 200 || rawFile2.status == 0){
              var allText2 = rawFile2.responseText;
              file_names2 = allText2.split("\n");
              for(var i = 0; i < file_names2.length; i++){
                  columns = file_names2[i].split(",");
                  dic[columns[0]] = new Array();
                  for(var ii = 1; ii < columns.length; ii++){
                      dic[columns[0]].push(columns[ii]);
                  }
              }
          }
      }
  }
  rawFile2.send(null);
  var val = document.getElementById('s1').value;
  var target = document.getElementById("output2");
  var file = "./PDF_list.txt";
  var url = "<br>";
  var rawFile = new XMLHttpRequest();
  rawFile.open("GET", file, false);
  rawFile.onreadystatechange = function (){
      if(rawFile.readyState == 4){
          if(rawFile.status === 200 || rawFile.status == 0){
              var allText = rawFile.responseText;
              var type = typeof allText;
              file_names = allText.split("\n");
              for(var i = 0; i < file_names.length; i++){
                if(file_names[i].indexOf(val) != -1){
                  url += "<h3><div style='text-align:right;'><div style='text-align:left;float:left;'><input type='hidden' id='s31"+i+"' value='" + file_names[i] +"'>" + file_names[i] + "</input></div>カテゴリ：<input type='text' name='word' id='sss3"+i+"' value=''></input><input type='button' value='追加' onclick='addCategory("+i+");'></input><input type='button' value='削除' onclick='deleteCategory("+i+");'></input><input type='button'  value='更新' onclick='koshin();'><a href='dlPDF/" + file_names[i] + ".pdf#page=1 target='_blank''><img src='images/pdf-hiraku.png' alt='イラスト２' width=100 height=100></a><a href='dlPDF/" + file_names[i] + ".pdf.zip#page=1 target='_blank''><img src='images/pdf-DL.png' alt='イラスト3' width=100 height=100></a></div></h3><h4>カテゴリ<br>";
                  if(file_names[i] in dic){
                    for(n=0; n < dic[file_names[i]].length; n++){
                      url += "<input type='button' style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + dic[file_names[i]][n] + "' onclick='pushingButton("+n+", "+i+", "+file_names.length+");'>";
                    }
                  }
                  url += "</h4><br>";
                }
              }
              if(url === ''){
                url += val + 'を含むタイトルはありません。'
              }
              target.innerHTML = url;
          }
      }
  }
  rawFile.send(null);
  target.innerHTML = url;
}

function clearText(){
  document.getElementById('s1').value = '';
}

function koshin(){
  location.reload();
}

</script>
<h3>検索カテゴリ：<input type="text" name="txtb_kc" value=""><input type="button" value="検索"><input type="button" value="クリア" onclick="clearText();"></3>
カテゴリ一覧<br>
<div id='output3'></div>
<div id='output4'></div>

</section>

<p class="pagetop"><a href="#">↑</a></p>

</div>



<div class="contents" id="all_list">

<section>

<h2>ALL List</h2>
<p>PFD化した書籍の一覧です。<br></p>
<script type="text/javascript">

function readTextFile2(){
    var file = "./PDF_list.txt";
    var file2 = "./PDF_list_column.txt";
    var url = "";
    var target = document.getElementById("output");
    var target2 = document.getElementById("output");
    var rawFile = new XMLHttpRequest();
    var rawFile2 = new XMLHttpRequest();
    var dic = {};
    rawFile2.open("GET", file2, false);
    rawFile2.onreadystatechange = function (){
        if(rawFile2.readyState == 4){
            if(rawFile2.status === 200 || rawFile2.status == 0){
                var allText2 = rawFile2.responseText;
                file_names2 = allText2.split("\n");
                for(var i = 0; i < file_names2.length; i++){
                    columns = file_names2[i].split(",");
                    dic[columns[0]] = new Array();
                    for(var ii = 1; ii < columns.length; ii++){
                        dic[columns[0]].push(columns[ii]);
                    }
                }
            }
        }
    }
    rawFile2.send(null);
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function (){
        if(rawFile.readyState == 4){
            if(rawFile.status === 200 || rawFile.status == 0){
                var allText = rawFile.responseText;
                file_names = allText.split("\n");
                for(var i = 0; i < file_names.length; i++){
                  url += "<h3><div style='text-align:right;'><div style='text-align:left;float:left;'><input type='hidden' id='s31"+i+"' value='" + file_names[i] +"'>" + file_names[i] + "</input></div>カテゴリ：<input type='text' name='word' id='sss3"+i+"' value=''></input><input type='button' value='追加' onclick='addCategory("+i+");'></input><input type='button' value='削除' onclick='deleteCategory("+i+");'></input><input type='button' value='更新' onclick='koshin();'></input><a href='dlPDF/" + file_names[i] + ".pdf#page=1 target='_blank''><img src='images/pdf-hiraku.png' alt='イラスト２' width=100 height=100></a><a href='dlPDF/" + file_names[i] + ".pdf.zip#page=1 target='_blank''><img src='images/pdf-DL.png' alt='イラスト3' width=100 height=100></a></div></h3><h4>カテゴリ<br>";
                  if(file_names[i] in dic){
                      for(n=0; n < dic[file_names[i]].length; n++){
                        url += "<input type='button' id='"+file_names[i]+"s2"+n+"' style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + dic[file_names[i]][n] + "' onclick='pushingButton("+n+","+i+","+file_names.length+");'>";
                      }
                  }
                  url += "</h4><br>";
                }
                target.innerHTML = url;
            }
        }
    }
    rawFile.send(null);
    var file3 = "./column_list.txt";
    var url3 = "";
    var target3 = document.getElementById("output3");
    var rawFile3 = new XMLHttpRequest();
    rawFile3.open("GET", file3, false);
    rawFile3.onreadystatechange = function (){
        if(rawFile3.readyState == 4){
            if(rawFile3.status === 200 || rawFile3.status == 0){
                var allText3 = rawFile3.responseText;
                file_names3 = allText3.split("\n");
                for(var ii = 0; ii < file_names3.length-1; ii++){
                    url3 += "<input type='button' id='cate"+ii+"' style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + file_names3[ii] + "' onclick='cateSearch("+ii+");'>";
                }
            }
            target3.innerHTML = url3;
        }
    }
    rawFile3.send(null);
}


window.onload =　function readTextFile1(){
    var file = "./PDF_list.txt";
    var file2 = "./PDF_list_column.txt";
    var url = "";
    var target = document.getElementById("output");
    var target2 = document.getElementById("output");
    var rawFile = new XMLHttpRequest();
    var rawFile2 = new XMLHttpRequest();
    var dic = {};
    rawFile2.open("GET", file2, false);
    rawFile2.onreadystatechange = function (){
        if(rawFile2.readyState == 4){
            if(rawFile2.status === 200 || rawFile2.status == 0){
                var allText2 = rawFile2.responseText;
                file_names2 = allText2.split("\n");
                for(var i = 0; i < file_names2.length; i++){
                    columns = file_names2[i].split(",");
                    dic[columns[0]] = new Array();
                    for(var ii = 1; ii < columns.length; ii++){
                        dic[columns[0]].push(columns[ii]);
                    }
                }
            }
        }
    }
    rawFile2.send(null);
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function (){
        if(rawFile.readyState == 4){
            if(rawFile.status === 200 || rawFile.status == 0){
                var allText = rawFile.responseText;
                file_names = allText.split("\n");
                for(var i = 0; i < file_names.length; i++){
                  url += "<h3><div style='text-align:right;'><div style='text-align:left;float:left;'><input type='hidden' id='s31"+i+"' value='" + file_names[i] +"'>" + file_names[i] + "</b></div>カテゴリ：<input type='text' name='word' id='sss3"+i+"' value=''><input type='button' value='追加' onclick='addCategory("+i+");'></input><input type='button' value='削除' onclick='deleteCategory("+i+");'></input><input type='button'  value='更新' onclick='koshin();'></input><a href='dlPDF/" + file_names[i] + ".pdf#page=1 target='_blank''><img src='images/pdf-hiraku.png' alt='イラスト２' width=100 height=100></a><a href='dlPDF/" + file_names[i] + ".pdf.zip#page=1 target='_blank''><img src='images/pdf-DL.png' alt='イラスト3' width=100 height=100></a></div></h3><h4>カテゴリ<br>";
                  if(file_names[i] in dic){
                      for(n=0; n < dic[file_names[i]].length; n++){
                        url += "<input type='button' id='"+file_names[i]+"s2"+n+"'  style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + dic[file_names[i]][n] + "' onclick='pushingButton("+n+","+i+","+file_names.length+");'>";
                      }
                  }
                  url += "</h4><br>";
                }
                target.innerHTML = url;
            }
        }
    }
    rawFile.send(null);
    var file3 = "./column_list.txt";
    var url3 = "";
    var target3 = document.getElementById("output3");
    var rawFile3 = new XMLHttpRequest();
    rawFile3.open("GET", file3, false);
    rawFile3.onreadystatechange = function (){
        if(rawFile3.readyState == 4){
            if(rawFile3.status === 200 || rawFile3.status == 0){
                var allText3 = rawFile3.responseText;
                file_names3 = allText3.split("\n");
                for(var ii = 0; ii < file_names3.length-1; ii++){
                    url3 += "<input type='button' id='cate"+ii+"' style='font:200pt MS ゴシック; WIDTH:150px; HEIGHT:150px' value='" + file_names3[ii] + "' onclick='cateSearch("+ii+");'>";
                }
            }
            target3.innerHTML = url3;
        }
    }
    rawFile3.send(null);
}

function pushingButton(a, b, c){
    tmp = String(a);
    tmp1 = String(b);
    var title = document.getElementById('s31' + tmp1).value;
    var val1 = document.getElementById(title + 's2' + tmp).value;
    for(n=0; n < c; n++){
        tmp2 = String(n);
        document.getElementById('sss3' + tmp2).value = '' ;
    }
    document.getElementById('sss3' + tmp1).value = val1;
}

function addCategory(a){
  tmp = String(a)
  var add_val = document.getElementById('sss3' + tmp).value;
  var title = document.getElementById('s31' + tmp).value;
  var file = "./PDF_list_column.txt";
  var request = new XMLHttpRequest();
  request.open('GET', 'http://192.168.60.62:5000/?title='+title+'&column='+add_val);
  request.onreadystatechange = function () {
    if (request.readyState != 4) {
        // リクエスト中
    } else if (request.status != 0) {
        // 失敗
        document.write(request.status);
        document.write('失敗');
    } else {
        // 取得成
        var result = request.responseText;
    }
  }
  request.send(null);
  document.getElementById('sss3' + tmp).value = '';
  readTextFile2();
  var request1 = new XMLHttpRequest();
  request1.open('GET', 'http://192.168.60.62:5000/update/');
  request1.onreadystatechange = function () {
    if (request1.readyState != 4) {
        // リクエスト中
    } else if (request1.status != 0) {
        // 失敗
        document.write(request1.status);
        document.write('失敗');
    } else {
        // 取得成
        var result = request.responseText;
    }
  }
  request1.send(null);
}

function deleteCategory(a){
  tmp = String(a)
  var add_val = document.getElementById('sss3' + tmp).value;
  var title = document.getElementById('s31' + tmp).value;
  var file = "./PDF_list_column.txt";
  var request = new XMLHttpRequest();
  request.open('GET', 'http://192.168.60.62:5000/delete/?title='+title+'&column='+add_val);
  request.onreadystatechange = function () {
    if (request.readyState != 4) {
        // リクエスト中
    } else if (request.status != 0) {
        // 失敗
        document.write(request.status);
        document.write('失敗');
    } else {
        // 取得成功
        var result = request.responseText;
    }
  }
  request.send(null);
  document.getElementById('sss3' + tmp).value = '';
  readTextFile2();
  var request1 = new XMLHttpRequest();
  request1.open('GET', 'http://192.168.60.62:5000/update/');
  request1.onreadystatechange = function () {
    if (request1.readyState != 4) {
        // リクエスト中
    } else if (request1.status != 0) {
        // 失敗
        document.write(request1.status);
        document.write('失敗');
    } else {
        // 取得成
        var result = request.responseText;
    }
  }
  request1.send(null);
}
</script>
 <div id="output"></div>
</section>
</form>
<p class="pagetop"><a href="#">↑</a></p>

</div>
<!--/contents-->

<footer>
<small>Copyright&copy; <a href="index.html">SIMPLE SITE</a> All Rights Reserved.</small>
<span class="pr">《<a href="http://template-party.com/" target="_blank">Web Design:Template-Party</a>》</span>
</footer>

<!--背景用の画像の読み込み-->
<aside id="bg"><img src="images/bg.jpg" class="landscape"><img src="images/bg2.jpg" class="portrait"></aside>

</body>
</html>
